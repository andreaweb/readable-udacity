Currently very messy. Will optimize in next commits!
